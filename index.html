<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">

    <link rel="stylesheet" href="spacesim.css">

    <script src="js/SpaceSim.js"></script>

    <script src="js/Ships/PoweredModule.js"></script>
    <script src="js/Ships/CoreModules.js"></script>
    <script src="js/Ships/DefenseModules.js"></script>
    <script src="js/Ships/UtilityModules.js"></script>
    <script src="js/Ships/WeaponModules.js"></script>
    <script src="js/Ships/Ship.js"></script>

    <script src="js/Ships/CoreModules/Capacitor.js"></script>
    <script src="js/Ships/CoreModules/FuelTank.js"></script>
    <script src="js/Ships/CoreModules/Generator.js"></script>
    <script src="js/Ships/CoreModules/LifeSupport.js"></script>
    <script src="js/Ships/CoreModules/Thrusters.js"></script>
    <script src="js/Ships/CoreModules/WarpCore.js"></script>
    <script src="js/Ships/DefenseModules/HullPlating.js"></script>
    <script src="js/Ships/UtilityModules/CargoHold.js"></script>
    <script src="js/Ships/WeaponModules/Weapon.js"></script>

    <script src="resources/Ships/CoreModules/Capacitors.js"></script>
    <script src="resources/Ships/CoreModules/FuelTanks.js"></script>
    <script src="resources/Ships/CoreModules/Generators.js"></script>
    <script src="resources/Ships/CoreModules/LifeSupports.js"></script>
    <script src="resources/Ships/CoreModules/Thrusters.js"></script>
    <script src="resources/Ships/CoreModules/WarpCores.js"></script>
    <script src="resources/Ships/DefenseModules/HullPlatings.js"></script>
    <script src="resources/Ships/UtilityModules/CargoHolds.js"></script>

    <script src="resources/Ships/Manufacturers/HopferBranchen.js"></script>
    <script src="resources/Ships/Manufacturers/Ikitomi.js"></script>
  </head>
  <body style="background-color: #000;">
    <div class="container-fluid">
      <div id="headerMenu" class="card text-white bg-dark mb-3">
        <div class="card-header">
          <div class="container-fluid">
            <div class="row">
              <div class="col-md-6">
                <div class="container-fluid">
                  <div class="row">
                    <div class="col-xs-2">
                      <div class="dropdown">
                        <button id="shipList" type="button" class="btn btn-outline-warning btn-secondary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></button>
                        <div id="shipDropdownList" class="dropdown-menu bg-dark" aria-labelledby="shipDropdownMenuButton"></div>
                      </div>
                    </div>
                    <div class="col-xs-1"> &nbsp; </div>
                    <div class="col-xs-9">
                      <h5 id="shipName">[Ship name here]</h5>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <h5>Statistics &amp; Characteristics</h5>
              </div>
            </div>
          </div>
        </div>
        <div class="card-body">
          <div class="container-fluid">
            <div class="row">
              <div class="col-md-6">
                <div class="card bg-dark">
                  <div class="card-header"><h5>Core Modules</h5></div>
                  <ul class="list-group list-group-flush">
                    <li class="list-group-item bg-dark">
                      <div class="btn-group btn-block" role="group">
                        <button id="capacitorMaxSize" type="button" class="btn btn-warning">n/a</button>
                        <div class="btn-group btn-block" role="group">
                          <button type="button" class="btn btn-outline-warning dropdown-toggle btn-block" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Select: <i>Capacitor</i>
                          </button>
                          <div class="dropdown-menu bg-dark">
                            <table class="table table-sm table-hover">
                              <tbody id="capacitorTableBody"></tbody>
                            </table>
                          </div>
                        </div>
                        <button id="installedCapacitor" type="button" class="btn btn-outline-warning">n/a</button>
                      </div>
                    </li>
                    <li class="list-group-item bg-dark">
                      <div class="btn-group btn-block" role="group">
                        <button id="fuelTankMaxSize" type="button" class="btn btn-warning">n/a</button>
                        <div class="btn-group btn-block" role="group">
                          <button type="button" class="btn btn-outline-warning dropdown-toggle btn-block" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Select: <i>Fuel Tank</i>
                          </button>
                          <div class="dropdown-menu bg-dark">
                            <table class="table table-sm table-hover">
                              <tbody id="fuelTankTableBody"></tbody>
                            </table>
                          </div>
                        </div>
                        <button id="installedFuelTank" type="button" class="btn btn-outline-warning">n/a</button>
                      </div>
                    </li>
                  </ul>
                </div>
              </div>
              <div class="col-md-6">
                <table class="table table-sm table-hover">
                  <thead>
                    <tr>
                      <td>Mass <small><i>(tonnes)</i></small></td>
                      <td>Jump Range <small><i>(lightyears)</i></small></td>
                      <td>Fuel for max jump <small><i>(tonnes)</i></small></td>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td><span id="shipMass">n/a</span></td>
                      <td><span id="shipJumpRange">n/a</span> <small><i>(of <span id="maxJumpRange">n/a</span> max)</i></small></td>
                      <td><span id="shipJumpFuel">n/a</span> <small><i>(of <span id="maxFuel">n/a</span> max)</i></small></td>
                    </tr>
                  </tbody>
                </table>
                <table class="table table-sm table-hover">
                  <thead>
                    <tr>
                      <td>Power Consumed <small><i>(MegaWatts)</i></small></td>
                      <td>Heat Generated <small><i>(Degrees Celcius)</i></small></td>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td><span id="shipPower">n/a</span> <small><i>(of <span id="maxPower">n/a</span> max)</i></small></td>
                      <td><span id="shipHeat">n/a</span> <small><i>(of <span id="maxHeat">n/a</span> max)</i></small></td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </span>
    </div>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>
    <script type="text/javascript">
      var currentShip = null;

      function displayStats() {
        if (currentShip) {
          var shipMass = currentShip.getTotalMass();
          var shipRange = currentShip.coreModules.warpCore.getJumpRange(shipMass);
          var shipFuelMaxJump = currentShip.coreModules.warpCore.getFuelNeededForJump(shipMass, shipRange);

          document.querySelector('#shipMass').innerText = shipMass;
          document.querySelector('#shipJumpRange').innerText = (isNaN(shipRange)) ? NaN : shipRange.toFixed(2);
          document.querySelector('#maxJumpRange').innerText = currentShip.coreModules.warpCore.maximumRange;
          document.querySelector('#shipJumpFuel').innerText = (isNaN(shipFuelMaxJump)) ? NaN : shipFuelMaxJump.toFixed(2);
          document.querySelector('#maxFuel').innerText = currentShip.coreModules.warpCore.maximumFuel;

          document.querySelector('#shipPower').innerText = currentShip.coreModules.getTotalPowerConsumed()
          document.querySelector('#maxPower').innerText = currentShip.coreModules.generator.power;
          document.querySelector('#shipHeat').innerText = currentShip.getTotalHeat();
          document.querySelector('#maxHeat').innerText = 100;
        }
      }

      function setShip(shipName) {
        var newShip = SpaceSim.getShip(shipName);
        currentShip = newShip;
        displayStats();
      }

      function populateShipList() {
        var manufacterers = {};
        SpaceSim.ships.forEach(function(ship) {
          manufacterers[ship.manufacturer] = true;
        });
        var htmlList = document.querySelector('#shipDropdownList');
        $(htmlList).empty();
        var htmlToAppend = '';
        for (var manufacturerName in manufacterers) {
          if (manufacterers.hasOwnProperty(manufacturerName)) {
            htmlToAppend += '<h4 class="dropdown-header text-light">' + manufacturerName + '</h4>';
            SpaceSim.ships.forEach(function(ship) {
              if (ship.manufacturer == manufacturerName) {
                htmlToAppend += '<button onclick="setShip(\'' + ship.name + '\');" type="button" class="btn btn-block btn-outline-warning">' + ship.name + '</button>';
              }
            });
          }
        }
        htmlList.insertAdjacentHTML('beforeend', htmlToAppend);
      }

      function populateModuleList(tableBody, availableModules) {
        $(tableBody).empty();
        var htmlToAppend = '';
        for (var size=1; size<=8; size++) {
          htmlToAppend += '<tr class="moduleSize' + size + '">';
          var moduleClasses = ['A','B','C','D','E'];
          for(var j=0; j<moduleClasses.length; j++) {
            var availableModuleExists = false;

            // is there a module of the current size and class?
            for (var i=0; i<availableModules.length; i++) {
              var availableModule = availableModules[i];
              if (availableModule.size == size && availableModule.class == moduleClasses[j]) {
                availableModuleExists = true;
                break;
              }
            }
            if (availableModuleExists) {
              htmlToAppend += '<td><button type="button" class="btn btn-outline-warning">' + size + moduleClasses[j] + '</button></td>';
            } else {
              htmlToAppend += '<td><button type="button" class="btn btn-outline-light disabled" disabled>' + size + moduleClasses[j] + '</button></td>';
            }
          }
          htmlToAppend += '</tr>';
        }
        tableBody.insertAdjacentHTML('beforeend',htmlToAppend);
      }

      function populateCapacitorList() {
        var tableBody = document.querySelector('#capacitorTableBody');
        var available = SpaceSim.coreModules.capacitors;
        populateModuleList(tableBody, available);
      }

      function populateFuelTankList() {
        var tableBody = document.querySelector('#fuelTankTableBody');
        var available = SpaceSim.coreModules.fuelTanks;
        populateModuleList(tableBody, available);
      }

      $(function() {
        populateShipList();
        populateCapacitorList();
        populateFuelTankList();
      });
    </script>
  </body>
</html>
